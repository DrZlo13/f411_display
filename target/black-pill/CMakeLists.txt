set(TARGET "target/black-pill")

set(LINKER_SCRIPT ${PROJECT_SOURCE_DIR}/${TARGET}/STM32F411CEUx_FLASH.ld PARENT_SCOPE)

# All relative to project root
set(TARGET_SOURCE_DIR ${CMAKE_SOURCE_DIR}/${TARGET})
set(CUBE_DIR ${CMAKE_SOURCE_DIR}/lib/STM32CubeWB)

file(GLOB TARGET_SOURCES
	${TARGET_SOURCE_DIR}/startup_stm32f411xe.s
	${TARGET_SOURCE_DIR}/Core/Src/main.c
	${TARGET_SOURCE_DIR}/Drivers/STM32F4xx_HAL_Driver/Src/stm32f4xx_ll_gpio.c
	${TARGET_SOURCE_DIR}/Drivers/STM32F4xx_HAL_Driver/Src/stm32f4xx_ll_spi.c
	${TARGET_SOURCE_DIR}/Drivers/STM32F4xx_HAL_Driver/Src/stm32f4xx_ll_dma.c
	${TARGET_SOURCE_DIR}/Drivers/STM32F4xx_HAL_Driver/Src/stm32f4xx_ll_rcc.c
	${TARGET_SOURCE_DIR}/Drivers/STM32F4xx_HAL_Driver/Src/stm32f4xx_ll_utils.c
	${TARGET_SOURCE_DIR}/Drivers/STM32F4xx_HAL_Driver/Src/stm32f4xx_ll_exti.c
	${TARGET_SOURCE_DIR}/Drivers/STM32F4xx_HAL_Driver/Src/stm32f4xx_ll_usart.c
	${TARGET_SOURCE_DIR}/Core/Src/system_stm32f4xx.c
)

# Look here for header files.
set(TARGET_DIRECTORIES
	${TARGET_SOURCE_DIR}/Core/Inc
	${TARGET_SOURCE_DIR}/Drivers/STM32F4xx_HAL_Driver/Inc
	${TARGET_SOURCE_DIR}/Drivers/CMSIS/Device/ST/STM32F4xx/Include
	${TARGET_SOURCE_DIR}/Drivers/CMSIS/Include
)

set(TARGET_FLAGS
	USE_FULL_LL_DRIVER
	HSE_VALUE=25000000
	HSE_STARTUP_TIMEOUT=100
	LSE_STARTUP_TIMEOUT=5000
	LSE_VALUE=32768
	EXTERNAL_CLOCK_VALUE=12288000
	HSI_VALUE=16000000
	LSI_VALUE=32000
	VDD_VALUE=3300
	PREFETCH_ENABLE=1
	INSTRUCTION_CACHE_ENABLE=1
	DATA_CACHE_ENABLE=1
	STM32F411xE
	PARENT_SCOPE
)

# add include and source to parent scope
set(SOURCES
	${SOURCES}
	${TARGET_SOURCES}
	PARENT_SCOPE
)

set(INCLUDE_DIRECTORIES
	${INCLUDE_DIRECTORIES}
	${TARGET_DIRECTORIES}
	PARENT_SCOPE
)
